var LoadingUI=function(e){function t(){e.call(this),this.textField=null,this.loadingBg=null,this.lingdang=null,this.createView()}__extends(t,e);var i=(__define,t);return p=i.prototype,p.createView=function(){this.loadingBg=new egret.Bitmap(RES.getRes("loadingBg_jpg")),this.addChild(this.loadingBg);var e="lingdang_00",t=14,i=!0,n=30;this.lingdang=new MyMovieClip(e,t,i,n),this.addChild(this.lingdang),this.lingdang.start(),this.lingdang.scaleX=this.lingdang.scaleY=.2,this.lingdang.x=278,this.lingdang.y=410,this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=550,this.textField.width=GlobalData.stageW,this.textField.height=100,this.textField.textAlign="center",this.textField.text="0%"},p.stop=function(){this.lingdang.stop()},p.setProgress=function(e,t){this.textField.text=""+Math.floor(e/t*100)+"%"},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t);return p=i.prototype,p.onAddToStage=function(e){RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},p.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup("loading")},p.onResourceLoadComplete=function(e){"gameover"==e.groupName?(this.loadingView.stop(),this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),this.createGameScene()):"loading"==e.groupName&&(this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.loadGroup("preload"),RES.loadGroup("gameover"))},p.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},p.onResourceProgress=function(e){"gameover"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},p.createGameScene=function(){this.addChild(ViewManager.getInstance()),ViewManager.getInstance().start(),RES.getResAsync("data_json",function(e){GlobalData.data=e},this)},p.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},p.startAnimation=function(e){for(var t=this,i=new egret.HtmlTextParser,n=[],s=0;s<e.length;s++)n.push(i.parser(e[s]));var a=t.textfield,r=-1,h=function(){r++,r>=n.length&&(r=0);var e=n[r];t.changeDescription(a,e);var i=egret.Tween.get(a);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(h,t)};h()},p.changeDescription=function(e,t){e.textFlow=t},t}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var ViewManager=function(e){function t(){e.call(this),this.init()}__extends(t,e);var i=(__define,t);return p=i.prototype,p.init=function(){this.gamePlayingPanel=new GamePlayingPanel,this.addChild(this.gamePlayingPanel),this.gamePlayingPanel.start()},p.start=function(){this.addEventListener(ChangeSceneEvent.CHANGE_SCENE_EVENT,this.onChangeScene,this)},t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},p.onChangeScene=function(e){switch(e.obj.end(),e.eventType){case GamePlayingPanel.CHANGEPANEL:this.removeChildren(),this.gamePlayingPanel=new GamePlayingPanel,this.addChild(this.gamePlayingPanel),this.gamePlayingPanel.start();break;case GameEndPanel.GAME_END:this.gameEndPanel=new GameEndPanel,this.gameEndPanel.start(),this.addChild(this.gameEndPanel)}},t}(egret.Sprite);egret.registerClass(ViewManager,"ViewManager");var GlobalData=function(){function e(){}var t=(__define,e);return p=t.prototype,e.stageW=640,e.stageH=1136,e.result=null,e.isLoadingGroupOver=!1,e.data=[],e}();egret.registerClass(GlobalData,"GlobalData");var MyMovieClip=function(e){function t(t,i,n,s){void 0===n&&(n=!0),void 0===s&&(s=60),e.call(this),this._currentFrame=0,this._timer=null,this._list=[],this._totalFrame=0,this._pngOrJpg=null,this._defaultFrame=60,this._name=null,this._name=t,this._totalFrame=i,this._pngOrJpg=n?"_png":"_jpg",this._defaultFrame=s,this.init()}__extends(t,e);var i=__define,n=t;return p=n.prototype,p.init=function(){this._list=[],this.removeChildren(),this._currentFrame=0,this._timer=new egret.Timer(1e3/this._defaultFrame>>0);for(var e=0;e<=this._totalFrame;e++){var t=new egret.Bitmap,i=1e3+e;RES.getRes(this._name+i.toString()+this._pngOrJpg)?t.texture=RES.getRes(this._name+i.toString()+this._pngOrJpg):RES.getResAsync(this._name+i.toString()+this._pngOrJpg,function(e){t.texture=e},this),this._list.push(t)}this.addChild(this._list[0]),this._timer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this)},p.onTimer=function(e){this._currentFrame<this._totalFrame?this._currentFrame+=1:this._currentFrame=0,this.addChild(this._list[this._currentFrame]),0!=this._currentFrame?this.removeChild(this._list[this._currentFrame-1]):this.removeChild(this._list[this._list.length-1])},i(p,"currentFrame",function(){return this._currentFrame}),p.start=function(){this._timer.start()},p.reStart=function(){this.init(),this._timer.start()},p.stop=function(){this._timer.stop()},t}(egret.Sprite);egret.registerClass(MyMovieClip,"MyMovieClip");var ChangeSceneEvent=function(e){function t(t,i,n){void 0===i&&(i=!1),void 0===n&&(n=!1),e.call(this,t,i,n)}__extends(t,e);var i=(__define,t);return p=i.prototype,t.CHANGE_SCENE_EVENT="changesceneevent",t}(egret.Event);egret.registerClass(ChangeSceneEvent,"ChangeSceneEvent");var GameEndPanel=function(e){function t(){e.call(this),this.bg=null,this.restartBtn=null,this.gameOverTitle=null,this.init()}__extends(t,e);var i=(__define,t);return p=i.prototype,p.start=function(){this.restartBtn.touchEnabled=!0,this.restartBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTab,this),this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),this.addChild(GlobalData.result),GlobalData.result.reStart()},p.init=function(){this.bg=new egret.Bitmap(RES.getRes("gameoverBg_png")),this.addChild(this.bg);var e="whitelight",t=24,i=!0,n=60;this.whiteLight=new MyMovieClip(e,t,i,n);var s="giftbox",a=24,r=!0,h=60;this.giftbox=new MyMovieClip(s,a,r,h),this.gameOverTitle=new egret.Bitmap(RES.getRes("gameovertitle_png")),this.restartBtn=new egret.Bitmap(RES.getRes("playAgain_png"))},p.onEnterFrame=function(e){GlobalData.result._currentFrame==GlobalData.result._totalFrame&&(this.addChildAt(this.whiteLight,1),this.whiteLight.start(),this.addChildAt(this.giftbox,this.numChildren-1),this.giftbox.start(),this.addChild(this.gameOverTitle),this.gameOverTitle.y=288,this.gameOverTitle.x=102,this.addChild(this.restartBtn),this.restartBtn.x=268,this.restartBtn.y=868,GlobalData.result.stop(),this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this))},p.onTouchTab=function(e){var t=new ChangeSceneEvent(ChangeSceneEvent.CHANGE_SCENE_EVENT);t.eventType=GamePlayingPanel.CHANGEPANEL,t.obj=this,ViewManager.getInstance().dispatchEvent(t)},p.end=function(){GlobalData.result&&GlobalData.result.parent&&this.removeChild(GlobalData.result),this.removeChild(this.whiteLight),this.whiteLight.stop(),this.removeChild(this.giftbox),this.giftbox.stop(),this.removeChild(this.gameOverTitle),this.removeChild(this.restartBtn),this.restartBtn.touchEnabled=!1,this.restartBtn.hasEventListener(egret.TouchEvent.TOUCH_TAP)&&this.restartBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTab,this)},t.GAME_END="gameEnd",t}(egret.Sprite);egret.registerClass(GameEndPanel,"GameEndPanel");var GamePlayingPanel=function(e){function t(){e.call(this),this.timeNumbers=20,this.christmasTree=null,this.lingdang=null,this.isLingDangStop=!1,this.lingDangBg=null,this.isChristmasScaleOver=!1,this.one=null,this.two=null,this.three=null,this.four=null,this.five=null,this.six=null,this.christmasTreePerUpdateScale=.005,this.christmasTreeStartScale=.4,this.scaleTimer=null,this.init()}__extends(t,e);var i=(__define,t);return p=i.prototype,p.start=function(){this.christmasTree.start(),this.lingdang.start(),this.lingdang.touchEnabled=!0,this.timeNumbers=20,this.christmasTree.scaleX=this.christmasTree.scaleY=.4,this.isChristmasScaleOver&&(this.christmasTree.touchEnabled=!0),this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),this.christmasTree.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onChristmasTreeTouchTab,this)},p.init=function(){this.bg=new egret.Bitmap(RES.getRes("playingBg_jpg")),this.addChild(this.bg);var e="christmastree",t=135,i=!0,n=60;this.christmasTree=new MyMovieClip(e,t,i,n),this.addChild(this.christmasTree),this.christmasTree.scaleX=this.christmasTree.scaleY=.4,this.christmasTree.anchorOffsetX=.5*this.christmasTree.width,this.christmasTree.anchorOffsetY=this.christmasTree.height,this.christmasTree.x=.5*this.christmasTree.width,this.christmasTree.y=this.christmasTree.height,this.lingDangBg=new egret.Bitmap(RES.getRes("lingdangBg_png")),this.lingDangBg.x=515,this.lingDangBg.y=50,this.addChild(this.lingDangBg);var s="lingdang_00",a=14,r=!0,h=30;this.lingdang=new MyMovieClip(s,a,r,h);var o="one",l=84,g=!0,d=30;this.one=new MyMovieClip(o,l,g,d),GlobalData.result=this.one,this.addChild(this.lingdang),this.lingdang.scaleX=this.lingdang.scaleY=.2,this.lingdang.x=510,this.lingdang.y=44,this.lingdang.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLingDongTouchTab,this),this.isChristmasScaleOver=!1,this.timer=new egret.Timer(1e3,this.timeNumbers)},p.onEnterFrame=function(e){this.christmasTreeStartScale+=this.christmasTreePerUpdateScale,this.christmasTreeStartScale>1&&(this.christmasTreeStartScale=1,this.isChristmasScaleOver=!0),this.isChristmasScaleOver&&(this.timer.start(),this.christmasTree.touchEnabled=!0,this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this)),this.christmasTree.scaleX=this.christmasTree.scaleY=this.christmasTreeStartScale},p.onChristmasTreeTouchTab=function(e){for(var t=new egret.Point(e.stageX,e.stageY),i=this.christmasTree.currentFrame,n=GlobalData.data[i],s=0;s<n.length;s++){var a=n[s];if(this.isHit(t,a)){var r=a.name,h=84,o=!0,l=30;GlobalData.result=new MyMovieClip(r,h,o,l),this.onTimerComplete(null)}}},p.onTimer=function(e){},p.onTimerComplete=function(e){var t=new ChangeSceneEvent(ChangeSceneEvent.CHANGE_SCENE_EVENT);t.eventType=GameEndPanel.GAME_END,t.obj=this,ViewManager.getInstance().dispatchEvent(t)},p.end=function(){this.timer.hasEventListener(egret.TimerEvent.TIMER)&&this.timer.removeEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this.timer.hasEventListener(egret.TimerEvent.TIMER_COMPLETE)&&this.timer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this.onTimerComplete,this),this.timer.stop(),this.timer.reset(),this.christmasTree.stop(),this.lingdang.touchEnabled=!1,this.lingdang.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onLingDongTouchTab,this),this.christmasTree.touchEnabled=!1,this.christmasTree.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChristmasTreeTouchTab,this)},p.onLingDongTouchTab=function(e){this.isLingDangStop?(this.lingdang.start(),this.isLingDangStop=!1):(this.lingdang.stop(),this.isLingDangStop=!0)},p.onResourceLoadComplete=function(e){"gameover"==e.groupName&&RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this)},p.isHit=function(e,t){var i=100,n=100;return e.x>t.x&&e.x<t.x+i&&e.y>t.y&&e.y<t.y+n?!0:!1},t.CHANGEPANEL="changepanel",t}(egret.Sprite);egret.registerClass(GamePlayingPanel,"GamePlayingPanel");