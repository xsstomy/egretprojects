var Data=function(){function e(e,t,n){void 0===n&&(n="control"),this.userid=null,this.type=null,this.event=null,this.leftOrRight=null,this.userid=e,this.type=n,this.event=t,this.leftOrRight=null}var t=(__define,e);return p=t.prototype,e}();egret.registerClass(Data,"Data");var GlobalData=function(){function e(){}var t=(__define,e);return p=t.prototype,e.ip="192.168.1.104",e.port=8001,e.debuging=!0,e.userid="10000",e.type="control",e.stageW=480,e.stageH=800,e}();egret.registerClass(GlobalData,"GlobalData");var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var n=(__define,t);return p=n.prototype,p.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},p.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var n=(__define,t);return p=n.prototype,p.onAddToStage=function(e){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},p.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},p.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},p.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},p.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},p.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},p.createGameScene=function(){var e=new egret.Bitmap(RES.getRes("bgImage"));this.addChild(e),GlobalData.userid=egret.getOption("userid"),MyWebSocket.getInstance().init(GlobalData.ip,GlobalData.port),this.addChild(ViewManager.getInstance()),ViewManager.getInstance().start()},p.createBitmapByName=function(e){var t=new egret.Bitmap,n=RES.getRes(e);return t.texture=n,t},p.startAnimation=function(e){for(var t=this,n=new egret.HtmlTextParser,i=[],a=0;a<e.length;a++)i.push(n.parser(e[a]));var s=t.textfield,r=-1,o=function(){r++,r>=i.length&&(r=0);var e=i[r];t.changeDescription(s,e);var n=egret.Tween.get(s);n.to({alpha:1},200),n.wait(2e3),n.to({alpha:0},200),n.call(o,t)};o()},p.changeDescription=function(e,t){e.textFlow=t},t}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var MyWebSocket=function(){function e(){this.webSocket=new egret.WebSocket}var t=(__define,e);return p=t.prototype,e.getInstance=function(){return void 0===e.instance&&(e.instance=new e),e.instance},p.init=function(e,t){this.webSocket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.webSocket.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this.webSocket.connect(e,t),this.webSocket.addEventListener(egret.Event.CLOSE,this.onSocketClose,this),this.webSocket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this)},p.onSocketOpen=function(){var e=new Data(GlobalData.userid,"HelloWebSocket"),t=JSON.stringify(e);console.log("连接成功，发送数据："+t),this.webSocket.writeUTF(t)},p.sendMesssage=function(e){this.webSocket.writeUTF(e),this.webSocket.flush()},p.onReceiveMessage=function(e){var t=this.webSocket.readUTF(),n=new SceneEvent(SceneEvent.ChangeScene);n.eventData=JSON.parse(t),console.log("收到数据：msg =",n.eventData),GlobalData.userid==n.eventData.userid&&ViewManager.getInstance().dispatchEvent(n)},p.onSocketClose=function(){console.log("WebSocketClose")},p.onSocketError=function(){console.log("WebSocketError")},e.instance=void 0,e}();egret.registerClass(MyWebSocket,"MyWebSocket");var SceneEvent=function(e){function t(t,n,i){void 0===n&&(n=!1),void 0===i&&(i=!1),e.call(this,t,n,i)}__extends(t,e);var n=(__define,t);return p=n.prototype,t.ChangeScene="changeScene",t.GAME_START="gamestart",t.GAME_PLAYING="gameplaying",t.GAME_END="gameend",t}(egret.Event);egret.registerClass(SceneEvent,"SceneEvent");var ViewManager=function(e){function t(){e.call(this),this.gameStartScene=null,this.gamePlayingScene=null,this.gameEndScene=null}__extends(t,e);var n=(__define,t);return p=n.prototype,t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},p.start=function(){this.init()},p.init=function(){this.addEventListener(SceneEvent.ChangeScene,this.onMyEvent,this),this.gameStartScene=new GameStartScene,this.gamePlayingScene=new GamePlayingScene,this.gameEndScene=new GameEndScene,this.addChild(this.gameStartScene),this.gameStartScene.start()},p.onMyEvent=function(e){switch(e.eventData.event){case SceneEvent.GAME_START:break;case SceneEvent.GAME_PLAYING:this.removeChildren(),this.addChild(this.gamePlayingScene),this.gamePlayingScene.start();break;case SceneEvent.GAME_END:this.removeChildren(),this.addChild(this.gameEndScene),this.gameEndScene.start()}},t.instance=null,t}(egret.Sprite);egret.registerClass(ViewManager,"ViewManager");var GameEndScene=function(e){function t(){e.call(this),this.playAgainBtn=null,this.init()}__extends(t,e);var n=(__define,t);return p=n.prototype,p.init=function(){this.playAgainBtn=new egret.Bitmap(RES.getRes("playAgainBtn_png")),this.addChild(this.playAgainBtn),this.playAgainBtn.x=.5*(GlobalData.stageW-this.playAgainBtn.width),this.playAgainBtn.y=.5*(GlobalData.stageH-this.playAgainBtn.height),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.stop,this)},p.start=function(){this.playAgainBtn.touchEnabled=!0,this.playAgainBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTab,this)},p.stop=function(){this.playAgainBtn.touchEnabled=!1,this.playAgainBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTab,this)},p.onTouchTab=function(e){var t=new Data(GlobalData.userid,SceneEvent.GAME_PLAYING),n=JSON.stringify(t);MyWebSocket.getInstance().sendMesssage(n);var i=new SceneEvent(SceneEvent.ChangeScene);i.eventData=new Data(GlobalData.userid,SceneEvent.GAME_PLAYING),ViewManager.getInstance().dispatchEvent(i)},t}(egret.Sprite);egret.registerClass(GameEndScene,"GameEndScene");var GamePlayingScene=function(e){function t(){e.call(this),this.orientation=null,this.differenceNumber=20,this.perNumber=0,this.text=null,this.init()}__extends(t,e);var n=(__define,t);return p=n.prototype,p.init=function(){this.orientation=new egret.DeviceOrientation,this.orientation.addEventListener(egret.Event.CHANGE,this.onOrientation,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.stop,this),this.text=new egret.TextField,this.addChild(this.text)},p.start=function(){this.orientation.start()},p.stop=function(){this.orientation.stop()},p.onOrientation=function(e){if(this.perNumber=e.beta,this.perNumber>this.differenceNumber){this.text.text=this.perNumber.toString();var t=new Data(GlobalData.userid,"move");t.leftOrRight="right";var n=JSON.stringify(t);MyWebSocket.getInstance().sendMesssage(n)}else if(this.perNumber<-this.differenceNumber){this.text.text=this.perNumber.toString();var t=new Data(GlobalData.userid,"move");t.leftOrRight="left";var n=JSON.stringify(t);MyWebSocket.getInstance().sendMesssage(n)}},t}(egret.Sprite);egret.registerClass(GamePlayingScene,"GamePlayingScene");var GameStartScene=function(e){function t(){e.call(this),this.startBtn=null,this.init()}__extends(t,e);var n=(__define,t);return p=n.prototype,p.init=function(){this.startBtn=new egret.Bitmap(RES.getRes("startGameBtn_png")),this.addChild(this.startBtn),this.startBtn.x=.5*(GlobalData.stageW-this.startBtn.width),this.startBtn.y=.5*(GlobalData.stageH-this.startBtn.height),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.stop,this)},p.start=function(){this.startBtn.touchEnabled=!0,this.startBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTab,this)},p.stop=function(){this.startBtn.touchEnabled=!1,this.startBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTab,this)},p.onTouchTab=function(e){var t=new Data(GlobalData.userid,SceneEvent.GAME_PLAYING),n=JSON.stringify(t);MyWebSocket.getInstance().sendMesssage(n);var i=new SceneEvent(SceneEvent.ChangeScene);i.eventData=new Data(GlobalData.userid,SceneEvent.GAME_PLAYING),ViewManager.getInstance().dispatchEvent(i)},t}(egret.Sprite);egret.registerClass(GameStartScene,"GameStartScene");