var AssetAdapter=function(){function e(){}var t=(__define,e);return p=t.prototype,p.getAsset=function(e,t,n){function i(i){t.call(n,i,e)}if(RES.hasRes(e)){var s=RES.getRes(e);s?i(s):RES.getResAsync(e,i,this)}else RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_IMAGE)},e}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var game;!function(e){var t=function(){function e(){}var t=(__define,e);return p=t.prototype,e.gameResult=!0,e.distanceLength=0,e.targetDistance=1e4,e.stageH=800,e.stageW=480,e.currentSpeedY=6,e}();e.Data=t,egret.registerClass(t,"game.Data")}(game||(game={}));var LoadingUI=function(e){function t(){e.call(this),this.loadingLength=235,this.skinName="loadingUISkin"}__extends(t,e);var n=(__define,t);return p=n.prototype,p.setProgress=function(e,t){this.loadingText.text=""+Math.floor(e/t*100)+"%",this.loadingGroup.x+=Math.floor(this.loadingLength/t)},t}(eui.Component);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.apply(this,arguments),this.isThemeLoadEnd=!1,this.isResourceLoadEnd=!1}__extends(t,e);var n=(__define,t);return p=n.prototype,p.createChildren=function(){e.prototype.createChildren.call(this);var t=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",t),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},p.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup("loadingui")},p.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},p.onResourceLoadComplete=function(e){"preload"==e.groupName?(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),this.isResourceLoadEnd=!0,this.createScene()):"loadingui"==e.groupName&&(this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.loadGroup("preload"))},p.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},p.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},p.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},p.startCreateScene=function(){this.addChild(game.ViewManager.getInstance()),game.ViewManager.getInstance().start()},t}(eui.UILayer);egret.registerClass(Main,"Main");var ThemeAdapter=function(){function e(){}var t=(__define,e);return p=t.prototype,p.getTheme=function(e,t,n,i){function s(e){t.call(i,e)}function a(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),n.call(i))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(e,s,this,RES.ResourceItem.TYPE_TEXT)},e}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);var game;!function(e){var t=function(t){function n(n){t.call(this),this.startPos=new egret.Point,this.move=new e.MoveUtil(this,!1),this.name=n,this.texture=RES.getRes(n),null==this.texture&&console.log("car 资源名称不对"),this.addEventListener(egret.Event.ADDED,this.onAdded,this)}__extends(n,t);var i=(__define,n);return p=i.prototype,p.init=function(t){void 0===t&&(t=0);var n=0==t?100:280;this.move.startPos=new egret.Point(0,-this.texture.textureHeight),this.move.endPos=new egret.Point(0,e.Data.stageH),this.startPos.x=n,this.startPos.y=-this.texture.textureHeight},p.onAdded=function(){this.x=this.startPos.x,this.y=this.startPos.y},p.onEnterFrame=function(){this.move&&(this.move.onEnterFrame(),this.y>e.Data.stageH&&this.distory())},p.setSpeed=function(e){this.move.speedY=e},p.distory=function(){this&&this.parent&&(this.parent.removeChild(this),e.CarFactory.getInstance().reclaim(this))},n}(egret.Bitmap);e.Car=t,egret.registerClass(t,"game.Car")}(game||(game={}));var game;!function(e){var t=function(t){function n(){t.call(this),this.sceneEvent=new e.SceneEvent(e.SceneEvent.ChangeScene),this.skinName="gameOverSkin",this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAdded,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoved,this)}__extends(n,t);var i=(__define,n);return p=i.prototype,p.onAdded=function(t){this.sceneEvent.eventType=e.SceneEvent.GAME_START,this.resultGroup.y=-600,egret.Tween.get(this.resultGroup).to({y:97},500,egret.Ease.backOut),this.playAgainBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPlayAgain,this),e.Data.gameResult||(this.result.source="failedNotice_png")},p.onRemoved=function(e){egret.Tween.removeTweens(this.resultGroup),this.playAgainBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPlayAgain,this)},p.onPlayAgain=function(t){e.ViewManager.getInstance().dispatchEvent(this.sceneEvent)},n}(eui.Component);e.GameOver=t,egret.registerClass(t,"game.GameOver")}(game||(game={}));var game;!function(e){var t=function(t){function n(){t.call(this),this.sceneEvent=new e.SceneEvent(e.SceneEvent.ChangeScene),this.isTouching=!1,this.startTouchPos=new egret.Point,this.carsName=["car0_png","car1_png","car2_png"],this.preProduceCarTime=0,this.sumSarsNum=0,this.skinName="gamePlayingSkin",this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAdded,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoved,this)}__extends(n,t);var i=(__define,n);return p=i.prototype,p.onAdded=function(t){egret.Tween.get(this.carlight,{loop:!0}).to({alpha:0},300).to({alpha:1},300),this.bgMoveUtil=new e.MoveUtil(this.bg),this.bg1MoveUtil=new e.MoveUtil(this.bg1),this.roadblockMoveUtil=new e.MoveUtil(this.roadblock,!1),this.bgMoveUtil.startPos=new egret.Point(0,0),this.bgMoveUtil.endPos=new egret.Point(0,e.Data.stageH),this.bg1MoveUtil.startPos=new egret.Point(0,-e.Data.stageH),this.bg1MoveUtil.endPos=new egret.Point(0,0),this.sceneEvent.eventType=e.SceneEvent.GAME_END,this.sceneEvent.eventObj=this,this.roadblockMoveUtil.startPos=new egret.Point(80,416),this.roadblockMoveUtil.endPos=new egret.Point(0,e.Data.stageH),this.bgMoveUtil.getDistance(!0),this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},p.onTouchBegin=function(e){this.isTouching=!0,this.startTouchPos.x=e.stageX,this.startTouchPos.y=e.stageY,this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this)},p.onTouchMove=function(e){var t=this;this.isTouching&&(e.stageX-this.startTouchPos.x>50?(this.isTouching=!1,egret.Tween.get(this.carlight).to({x:281},300),egret.Tween.get(this.hero).to({x:287},300).call(function(e){t.isTouching=!0},this)):e.stageX-this.startTouchPos.x<-50&&(this.isTouching=!1,egret.Tween.get(this.carlight).to({x:94},300),egret.Tween.get(this.hero).to({x:100},300).call(function(e){t.isTouching=!0},this))),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},p.onTouchEnd=function(e){this.isTouching=!1,this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},p.onRemoved=function(){this.resetData()},p.resetData=function(){this.bg.y=0,this.bg1.y=-e.Data.stageH,this.roadblock.x=80,this.roadblock.y=416,this.carlight.x=281,this.hero.x=287,e.Data.distanceLength=0,e.CarFactory.getInstance().liveCarArray.length=0},p.onGameOver=function(){this.carLayer.removeChildren(),egret.Tween.removeTweens(this.carlight),this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),e.ViewManager.getInstance().dispatchEvent(this.sceneEvent)},p.onEnterFrame=function(t){this.isOver()&&this.onGameOver();var n=egret.getTimer();if(n-this.preProduceCarTime>Math.floor(500*Math.random()+1500)&&(this.randomProduceCar(),this.preProduceCarTime=n),e.CarFactory.getInstance().liveCarArray.length)for(var i,s=e.CarFactory.getInstance().liveCarArray.length-1;s>=0;s--)i=e.CarFactory.getInstance().liveCarArray[s],i.setSpeed(e.Data.currentSpeedY-2),i.onEnterFrame();this.bg1MoveUtil.onEnterFrame(),this.bgMoveUtil.onEnterFrame(),this.roadblockMoveUtil.onEnterFrame(),this.distanceNum.text=Math.floor(e.Data.distanceLength).toString()},p.isOver=function(){if(e.Data.distanceLength>=e.Data.targetDistance)return e.Data.gameResult=!0,!0;for(var t,n=e.CarFactory.getInstance().liveCarArray.length-1;n>=0;n--)if(t=e.CarFactory.getInstance().liveCarArray[n],this.isHit(t,this.hero))return e.Data.gameResult=!1,!0;return!1},p.randomProduceCar=function(){this.sumSarsNum++;var t=Math.floor(3*Math.random()),n=e.CarFactory.getInstance().produce(this.carsName[t]),i=Math.floor(2*Math.random());n.init(i),n.setSpeed(e.Data.currentSpeedY-2),this.carLayer.addChild(n)},p.isHit=function(e,t){var n=e,i=t;return Math.abs(n.x-i.x)<.5*(n.width+i.width)&&Math.abs(n.y-i.y)<.5*(n.height+i.height)?!0:!1},n}(eui.Component);e.GamePlaying=t,egret.registerClass(t,"game.GamePlaying")}(game||(game={}));var game;!function(e){var t=function(t){function n(){t.call(this),this.sceneEvent=new e.SceneEvent(e.SceneEvent.ChangeScene),this.skinName="gameStartSkin",this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAdded,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoved,this)}__extends(n,t);var i=(__define,n);return p=i.prototype,p.onAdded=function(t){this.sceneEvent.eventType=e.SceneEvent.GAME_PLAYING,this.sceneEvent.eventObj=this,this.startBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onStartGame,this)},p.onRemoved=function(e){this.startBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onStartGame,this)},p.onStartGame=function(t){e.ViewManager.getInstance().dispatchEvent(this.sceneEvent)},n}(eui.Component);e.GameStart=t,egret.registerClass(t,"game.GameStart")}(game||(game={}));var game;!function(e){var t=function(e){function t(t,n,i){void 0===n&&(n=!1),void 0===i&&(i=!1),e.call(this,t,n,i)}__extends(t,e);var n=(__define,t);return p=n.prototype,t.ChangeScene="changeScene",t.GAME_START="gamestart",t.GAME_PLAYING="gameplaying",t.GAME_END="gameend",t}(egret.Event);e.SceneEvent=t,egret.registerClass(t,"game.SceneEvent")}(game||(game={}));var game;!function(e){var t=function(t){function n(){t.call(this),this.cache={},this.liveCarArray=[]}__extends(n,t);var i=(__define,n);return p=i.prototype,n.getInstance=function(){return null==n.instance&&(n.instance=new n),n.instance},p.produce=function(t){null==this.cache[t]&&(this.cache[t]=[]);var n,i=this.cache[t];return n=i.length?i.shift():new e.Car(t),this.liveCarArray.push(n),n},p.reclaim=function(e){null==this.cache[e.name]&&(this.cache[e.name]=[]);var t=this.cache[e.name];-1==t.indexOf(e)&&this.cache[e.name].push(e);var n=this.liveCarArray.indexOf(e);-1!=n&&this.liveCarArray.splice(n,1)},n}(egret.Sprite);e.CarFactory=t,egret.registerClass(t,"game.CarFactory")}(game||(game={}));var game;!function(e){var t=function(t){function n(){t.call(this)}__extends(n,t);var i=(__define,n);return p=i.prototype,n.getInstance=function(){return null==n.instance&&(n.instance=new n),n.instance},p.start=function(){this.init(),this.initListener()},p.init=function(){this.gameStart=new e.GameStart,this.gameOver=new e.GameOver,this.gamePlaying=new e.GamePlaying,this.addChild(this.gameStart)},p.initListener=function(){this.addEventListener(e.SceneEvent.ChangeScene,this.onChangeScene,this)},p.onChangeScene=function(t){switch(this.removeChildren(),t.eventType){case e.SceneEvent.GAME_START:this.addChild(this.gameStart);break;case e.SceneEvent.GAME_PLAYING:this.addChild(this.gamePlaying);break;case e.SceneEvent.GAME_END:this.addChild(this.gameOver)}},n}(egret.Sprite);e.ViewManager=t,egret.registerClass(t,"game.ViewManager")}(game||(game={}));var game;!function(e){var t=function(t){function n(n,i){void 0===i&&(i=!0),t.call(this),this._startPos=new egret.Point(0,0),this._endPos=new egret.Point(0,e.Data.stageH),this._speedY=6,this._startSpeedY=6,this.obj=null,this.isLoop=!0,this._aSpeedY=.1,this.isGetDistance=!1,this.preEnterFrameTime=0,this.moveFrameNum=60,this.obj=n,this.isLoop=i}__extends(n,t);var i=__define,s=n;return p=s.prototype,i(p,"startPos",void 0,function(e){this._startPos!==e&&(this._startPos=e)}),i(p,"endPos",void 0,function(e){this._endPos!==e&&(this._endPos=e)}),i(p,"speedY",void 0,function(e){this._startSpeedY!==e&&(this._startSpeedY=e)}),p.getDistance=function(e){void 0===e&&(e=!1),this.isGetDistance=e},p.onEnterFrame=function(){if(!this.obj)return null;if(this.obj.y+=Math.floor(this._speedY),this._speedY>=20&&(this._speedY=20),this.obj.y>=this._endPos.y&&this.isLoop)this.obj.y=this._startPos.y;else if(this.obj.y>=this._endPos.y&&!this.isLoop)return void(this.obj=null);var t=Date.now();t-this.preEnterFrameTime>this.moveFrameNum&&(this.preEnterFrameTime=t,this._speedY+=this._aSpeedY,this.isLoop&&this.isGetDistance&&(e.Data.distanceLength+=.5*(this._speedY+this._startSpeedY),e.Data.currentSpeedY=this._speedY))},n}(egret.Sprite);e.MoveUtil=t,egret.registerClass(t,"game.MoveUtil")}(game||(game={}));